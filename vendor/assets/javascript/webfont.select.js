!function($){var t;return t={},$.widget("webfont.wfselect",{options:{fonts:{google:{families:[{name:"Droid Sans",url:null},{name:"Signika",url:null}],url_generation:{base_url:"https://fonts.googleapis.com/css?family=$font",space_char:"+"}}},merge_list:!1,load_all_fonts:!1,default_font_name:{type:"google",name:"Signika"}},_create:function(){var t,e,n,i;n=this,e=this.options,t=this.element,i=e.fonts||this.options.fonts,t.addClass("webfont-input").wrap($("<div/>").addClass("webfont-wrapper")),t.on("keyup paste",{instance:n},n._searchFontList),this.wrapper=t.closest(".webfont-wrappers"),t.after(n._createFontList(i,this.options.merge_list).hide()),n._selectFontByName(t.val()),n.toggle=$("<div/>").addClass("ui-icon ui-icon-triangle-1-s").insertAfter(t),n._bindHandlers(),e.load_all_fonts&&n._loadAllFonts()},_createFontList:function(t,e){var n,i;return null==e&&(e=!1),this.fontList=$("<ul/>").addClass("webfont-list"),i=this,n=this._createFontObjects(t,e),$.each(n,function(t,e){$("<li/>").html(e.font).data("font_name",e.font).data("font_type",e.type).data("font_url",e.url).css(i._fontToStyle(e.font)).appendTo(i.fontList)}),this.fontList},_searchFontList:function(t){var e,n,i,o,s;s=t.data.instance,e=$(this).val(),o=s.options.fonts,i=null,n=$.extend(!0,{},o),$.each(n,function(t,i){var o;o=i.families,n[t].families=o.filter(s._filterFontList,e)}),s.element.nextAll().remove(),s.element.after(s._createFontList(n,s.options.merge_list)),s._selectFontByName(s._getFirstFontInList(n),13!==t.keyCode),s._bindHandlers()},_filterFontList:function(t){return"string"==typeof t?t.toLowerCase().indexOf(this.toString().toLowerCase())>=0:t.name.toLowerCase().indexOf(this.toString().toLowerCase())>=0},_getFirstFontInList:function(t){var e,n;return e=t[Object.keys(t)[0]].families,e.length<1?null:(n=e[0],"string"==typeof n?n:n.name)},_createFontObjects:function(t,e){var n,i;return null==e&&(e=!1),n=[],i=this,$.each(t,function(e,o){var s;s=o.families.map(function(n){return"string"==typeof n?{font:n,type:e,url:i._generateFontUrl(t,e,n)}:{font:n.name,type:e,url:n.url||i._generateFontUrl(t,e,n.name)}}),n=n.concat(s)}),e&&(n=n.sort(function(t,e){return t.font>e.font})),n},_generateFontUrl:function(t,e,n){return void 0===t[e].url_generation?null:(void 0!==t[e].url_generation.space_char&&(n=n.split(" ").join(t[e].url_generation.space_char)),t[e].url_generation.base_url.replace("$font",n))},_fontToStyle:function(t){var e;return e=t.split(":"),{"font-family":this._readableFontName(e[0]),"font-weight":e[1]||400}},_readableFontName:function(t){return t.replace(/[\+|:]/g," ")},_selectFontByName:function(t,e){var n,i;return null==e&&(e=!1),n=this.fontList.find("li"),i=$.grep(n,function(e,n){return $(e).data("font_name")===t}),i.length?(this._selectFontListItem($(i).first(),e),!0):(void 0!==this.options.default_font_name&&this.element.attr("font_url",this._generateFontUrl(this.options.fonts,this.options.default_font_name.type,this.options.default_font_name.name)).trigger("change").trigger("default"),!1)},_selectFontListItem:function(t,e){var n,i,o,s;return null==e&&(e=!1),t.hasClass("selected")?null:(this.fontList.find("li.selected").removeClass("selected"),t=$(t).addClass("selected"),n=t.data("font_name"),i=t.data("font_type"),o=t.data("font_url"),s=this._fontToStyle(n),this.element.css(s),this._loadFonts([{font:n,type:i}]),this.element.val()!==n&&this.element.attr("font_url",o).trigger("change"),e||(this.element.val()!==n&&this.element.val(n),this._toggleFontList(!1)),void this._trigger("change",null,s))},_loadFonts:function(e){var n,i;return n=$.grep(e,function(e){return t[e.font]},!0),n.length?(i={},$.each(n,function(e,n){t[n.font]=!0,Object.keys(i).indexOf(n.type)===-1&&(i[n.type]={}),Object.keys(i[n.type]).indexOf("families")===-1&&(i[n.type].families=[]),i[n.type].families.push(n.font)}),void WebFont.load(i)):null},_loadAllFonts:function(){var e,n,i,o;return i=[{}],n=0,e=0,$.each(this.options.fonts,function(o,s){return i[n][o]={families:[]},$.each(s.families,function(s,l){return e++,e>=40&&(n++,e=0,i[n]={},i[n][o]={families:[]}),"string"==typeof l?(i[n][o].families.push(l),t[l]=!0):(i[n][o].families.push(l.name),t[l.name]=!0)})}),o=0,$.each(i,function(t,e){return setTimeout(function(){WebFont.load(e)},o+=200)})},_loadVisibleFonts:function(){var t,e,n,i,o;return this.fontList.is(":visible")?(o=this.fontList.scrollTop(),i=this.fontList.height(),n=o+i,t=this.fontList.find("li"),e=[],$.each(t,function(t,n){var o,s;n=$(n),s=n.position().top,o=s+n.outerHeight(),o>=0&&s<i&&e.push({font:n.data("font_name"),type:n.data("font_type")})}),void this._loadFonts(e)):null},_toggleFontList:function(t){var e;t?(this.wrapper.css({"z-index":999999}),this.fontList.show(),this._loadVisibleFonts(),e=this.fontList.find("li.selected"),e.length&&this.fontList.scrollTop(e.position().top)):(this.wrapper.css({"z-index":"auto"}),this.fontList.hide())},_bindHandlers:function(){var t,e,n;n=this,t=null,$("html").bind("click.webfont",function(t){n._toggleFontList(!1)}),e=function(t){n._toggleFontList(!0),t.stopPropagation()},this.element.bind("click.webfont",e),this.toggle.bind("click.webfont",e),this.fontList.bind("scroll.webfont",function(e){window.clearTimeout(t),t=window.setTimeout(function(){n._loadVisibleFonts()},250)}).bind("click.webfont",function(t){var e;return e=$(t.target),e.is("li")?void n._selectFontListItem(e):null})},destory:function(){this.fontList.remove(),this.toggle.remove(),this.element.removeClass("webfont-input").removeAttr("readonly").unbind("click.webfont").unwrap(),$("html").unbind("click.webfont"),$.Widget.prototype.destory.call(this)}})}(jQuery);
//# sourceMappingURL=./webfont.select.js.map